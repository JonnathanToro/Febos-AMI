import clienteAPI from "@/febos/servicios/clienteAPI";
import { mapState,mapActions} from "vuex";

export default {
  computed:{
    ...mapState('Empresas',{
      _datosPersonalizacion:'personalizacion'
    }),
    _dominioActual: function(){
      if(window.location.hostname.toLocaleLowerCase() == 'localhost'){
        return `portal.febos.${process.env.VUE_APP_CODIGO_PAIS}`
      }else return window.location.hostname.toLocaleLowerCase();
    }
  },
  methods:{
    ...mapActions('Personalizacion',{_cargarPersonalizacionEnState:'cargarPersonalizacion'}),
    _yaEstaCargadaLaPersonalizacion: function(){
      if(!this._datosPersonalizacion || this._datosPersonalizacion.dominio != this._dominioActual){
        return false;
      }
      return true;
    },
    async _cargarPersonalizacion(){
      let pais=`${process.env.VUE_APP_CODIGO_PAIS}`;
      let ambiente=`${process.env.VUE_APP_AMBIENTE}`;
      let url=`https://s3.amazonaws.com/archivos.febos.io/${pais}/${ambiente}/portales/${this._dominioActual}.json`;
      var self=this;
      clienteAPI.get(url).then(function(response){
        self._cargarPersonalizacionEnState(response.data);
        self.$emit('updateNavbarColor', response.data.colores.navbar);
        self.$vs.theme({ primary: response.data.colores.primario });
      });
    },
  },
  created(){
    if(!this._yaEstaCargadaLaPersonalizacion()){
      this._cargarPersonalizacion();
    }
  }
}
