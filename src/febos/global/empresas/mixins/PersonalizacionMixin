import clienteAPI from "@/febos/servicios/clienteAPI";
import {mapState, mapActions} from "vuex";

export default {
  computed: {
    ...mapState('Empresas', {
      _datosPersonalizacion: 'personalizacion'
    }),
    ...mapState('Personalizacion', {
      titulo: state => state.ingreso.tituloIngreso,
      bienvenida: state => state.ingreso.textoHtml,
      mostrarBtnClaveUnica: state => state.ingreso.botonClaveUnica,
      mostrarBtnPP: state => state.ingreso.botonRegistroProveedor,
      textoBotonPP: state => state.ingreso.nombreBotonRegistroProveedores,
      textoBotonIngreso: state => state.ingreso.nombreBotonIngreso,
      campoClave: state => state.ingreso.nombreCampoClave,
      campoUsuario: state => state.ingreso.nombreCampoUsuario,
      imagenIngreso: state => state.ingreso.imagenIngreso,
      colorFondoImagenIngreso: state => state.ingreso.colorFondoImagenIngreso,
      imagenFondo: state => state.ingreso.imagenFondo,
      logo: state => state.menu.logo,
      ingresoLogo: state => state.ingreso.logo
    }),
    _dominioActual: function () {
      if (window.location.hostname.toLocaleLowerCase() == 'localhost') {
        return `portal.febos.${process.env.VUE_APP_CODIGO_PAIS}`
      } else return window.location.hostname.toLocaleLowerCase();
    },
    _estiloLogo() {
      //console.log("DENTRO DEL MIXIN",this._datosPersonalizacion);
      let estilo = {
        position: "fixed",
        margin: this.ingresoLogo.margen,
        width: this.ingresoLogo.ancho,
        height: this.ingresoLogo.alto
      };
      switch (this.ingresoLogo.ubicacionVertical) {
        case "superior":
          estilo.top = 0;
          break;
        case "inferior":
          estilo.bottom = 0;
          break;
      }
      switch (this.ingresoLogo.ubicacionHorizontal) {
        case "izquierda":
          estilo.left = 0;
          break;
        case "derecha":
          estilo.right = 0;
          break;
      }
      return estilo;
    }
  },
  methods: {
    ...mapActions('Personalizacion', {_cargarPersonalizacionEnState: 'cargarPersonalizacion'}),
    _yaEstaCargadaLaPersonalizacion: function () {
      //if(!this._datosPersonalizacion || this._datosPersonalizacion.dominio != this._dominioActual){
      //  return false;
      //}
      //return true;
      console.log("NO esta cargada");
      return false;
    },
    async _cargarPersonalizacion() {
      let pais = `${process.env.VUE_APP_CODIGO_PAIS}`;
      let ambiente = `${process.env.VUE_APP_AMBIENTE}`;
      let url = `https://s3.amazonaws.com/archivos.febos.io/${pais}/${ambiente}/portales/${this._dominioActual}.json`;
      var self = this;
      clienteAPI.get(url).then(function (response) {
        self._cargarPersonalizacionEnState(response.data);
        self.$emit('updateNavbarColor', response.data.colores.navbar);
        self.$vs.theme({primary: response.data.colores.primario});
        document.title = response.data.general.titulo;
        (function() {
          var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
          link.type = 'image/x-icon';
          link.rel = 'shortcut icon';
          link.href = response.data.general.favicon;
          document.getElementsByTagName('head')[0].appendChild(link);
        })();
      });
    }
  },
  created() {
    console.log("Cargando personalizacion");
    this._cargarPersonalizacion();
    //if(!this._yaEstaCargadaLaPersonalizacion()){
    //  this._cargarPersonalizacion();
    // }
  }
}
